{
  "name": "SecretaryV1.0.0",
  "nodes": [
    {
      "parameters": {
        "cronExpression": "0 * * * *"
      },
      "id": "CronSync",
      "name": "Cron Sync Events",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 2,
      "position": [
        200,
        100
      ]
    },
    {
      "parameters": {
        "url": "https://api.zaia.app/calendar/events",
        "options": {}
      },
      "id": "HTTP_GetCalendar",
      "name": "Get Calendar Events",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        400,
        100
      ]
    },
    {
      "parameters": {
        "operation": "upsert",
        "schema": "public",
        "table": "calendar_events",
        "columns": [
          "external_id",
          "title",
          "start_date",
          "end_date",
          "status"
        ],
        "values": "={{$json}}"
      },
      "id": "Supabase_UpsertEvent",
      "name": "Upsert Event",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        600,
        100
      ]
    },
    {
      "parameters": {
        "imap": "={{...}}"
      },
      "id": "IMAP_EmailTrigger",
      "name": "Email Trigger",
      "type": "n8n-nodes-base.imapEmail",
      "typeVersion": 1,
      "position": [
        200,
        300
      ]
    },
    {
      "parameters": {
        "functionCode": "// decide if cria tarefa ou responde",
        "output": "main"
      },
      "id": "Function_ProcessEmail",
      "name": "Process Email",
      "type": "n8n-nodes-base.function",
      "typeVersion": 2,
      "position": [
        400,
        300
      ]
    },
    {
      "parameters": {
        "operation": "insert",
        "schema": "public",
        "table": "tasks",
        "columns": [
          "user_id",
          "title",
          "description",
          "status",
          "due_date"
        ],
        "values": "={{$json}}"
      },
      "id": "Supabase_InsertTask",
      "name": "Insert Task",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        600,
        300
      ]
    },
    {
      "parameters": {
        "mode": "smtp",
        "fromEmail": "secretary@company.com",
        "toEmail": "={{$json[\"sender\"]}}",
        "subject": "Re: {{$json[\"subject\"]}}",
        "text": "={{$json[\"responseText\"]}}"
      },
      "id": "SMTP_Reply",
      "name": "SMTP Reply",
      "type": "n8n-nodes-base.smtp",
      "typeVersion": 1,
      "position": [
        800,
        300
      ]
    }
  ],
  "connections": {
    "Cron Sync Events": {
      "main": [
        [
          {
            "node": "HTTP_GetCalendar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Get Calendar Events": {
      "main": [
        [
          {
            "node": "Supabase_UpsertEvent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IMAP Email Trigger": {
      "main": [
        [
          {
            "node": "Function Process Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Function Process Email": {
      "main": [
        [
          {
            "node": "Supabase Insert Task",
            "type": "main",
            "index": 0
          },
          {
            "node": "SMTP Reply",
            "type": "main",
            "index": 1
          }
        ]
      ]
    }
  }
}
